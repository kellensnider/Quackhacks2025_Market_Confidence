<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Market Confidence ‚Äì 10-Year History</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root {
      --bg: #020817;
      --bg-alt: #020617;
      --card: #020817;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.15);
      --text-main: #e5e7eb;
      --text-muted: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.3);
      --radius-lg: 18px;
      --radius-xl: 24px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.8);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a 0, #020617 45%, #000 100%);
      color: var(--text-main);
      min-height: 100vh;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 24px 16px 48px;
    }

    header {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 24px;
    }

    @media (min-width: 768px) {
      header {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }
    }

    .title-block h1 {
      font-size: 1.5rem;
      letter-spacing: 0.03em;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-pill {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.35);
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .subtitle {
      margin: 4px 0 0;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .nav-links {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: flex-start;
      flex-wrap: wrap;
    }

    .nav-link {
      font-size: 0.8rem;
      padding: 6px 12px;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      color: var(--text-muted);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15, 23, 42, 0.7);
      backdrop-filter: blur(16px);
      transition: border 0.15s ease, background 0.15s ease, color 0.15s ease,
        transform 0.1s ease;
    }

    .nav-link:hover {
      border-color: rgba(148, 163, 184, 0.8);
      color: var(--text-main);
      transform: translateY(-1px);
    }

    .nav-link.primary {
      border-color: rgba(34, 197, 94, 0.6);
      color: var(--accent);
      background: radial-gradient(circle at top left, #064e3b 0, #020817 45%);
    }

    .nav-link span.icon {
      font-size: 0.9rem;
    }

    .info-banner {
      margin-bottom: 22px;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      background: radial-gradient(circle at left, rgba(34, 197, 94, 0.08), transparent 60%);
      font-size: 0.78rem;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .info-badge {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: var(--accent);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.8);
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 18px;
    }

    @media (min-width: 900px) {
      .grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .card {
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-subtle);
      background: radial-gradient(circle at top, rgba(51, 65, 85, 0.2), #020617 52%);
      padding: 14px 14px 18px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      min-height: 260px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 8px;
      gap: 8px;
    }

    .card-title {
      font-size: 0.95rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card-title-pill {
      font-size: 0.7rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(148, 163, 184, 0.6);
      color: var(--text-muted);
    }

    .card-meta {
      font-size: 0.7rem;
      color: var(--text-muted);
      text-align: right;
    }

    .chart-container {
      position: relative;
      flex: 1;
      margin-top: 6px;
    }

    canvas {
      width: 100% !important;
      height: 220px !important;
    }

    footer {
      margin-top: 26px;
      font-size: 0.75rem;
      color: var(--text-muted);
      text-align: center;
      opacity: 0.9;
    }

    footer code {
      font-size: 0.7rem;
      padding: 2px 4px;
      border-radius: 6px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(55, 65, 81, 0.9);
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="title-block">
        <h1>
          10-Year History
          <span class="title-pill">Price + Confidence</span>
        </h1>
        <p class="subtitle">
          Static view of historical price and sentiment inputs that feed the main
          market confidence engine.
        </p>
      </div>

      <nav class="nav-links">
        <a href="index.html" class="nav-link primary">
          <span class="icon">‚Üê</span>
          Back to Live Dashboard
        </a>
        <span class="nav-link">
          <span class="icon">üìä</span>
          Data: <code>history-data.csv</code>
        </span>
      </nav>
    </header>

    <div class="info-banner">
      <span class="info-badge"></span>
      <span>
        This page is 100% static. It reads <code>history-data.csv</code> in the browser, then
        builds charts for each market. Update the CSV ‚Üí refresh ‚Üí charts update.
      </span>
    </div>

    <main class="grid">
      <!-- Bitcoin -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">
            Bitcoin
            <span class="card-title-pill">Price &amp; Confidence</span>
          </div>
          <div class="card-meta">Source: CSV &bull; 10-year window</div>
        </div>
        <div class="chart-container">
          <canvas id="btcChart"></canvas>
        </div>
      </section>

      <!-- Gold -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">
            Gold
            <span class="card-title-pill">Spot &amp; Confidence</span>
          </div>
          <div class="card-meta">Source: CSV &bull; 10-year window</div>
        </div>
        <div class="chart-container">
          <canvas id="goldChart"></canvas>
        </div>
      </section>

      <!-- S&P 500 -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">
            S&amp;P 500
            <span class="card-title-pill">Index &amp; Confidence</span>
          </div>
          <div class="card-meta">Source: CSV &bull; 10-year window</div>
        </div>
        <div class="chart-container">
          <canvas id="spxChart"></canvas>
        </div>
      </section>

      <!-- Market Confidence -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">
            Market Confidence
            <span class="card-title-pill">Total Index</span>
          </div>
          <div class="card-meta">Source: Algorithm Output</div>
        </div>
        <div class="chart-container">
          <canvas id="marketConfidenceChart"></canvas>
        </div>
      </section>


      <!-- Placeholder card for future markets (ETFs, Housing, etc.) -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">
            Coming Next
            <span class="card-title-pill">ETFs / Housing / USD</span>
          </div>
          <div class="card-meta">Extend with more columns</div>
        </div>
        <p style="font-size:0.8rem; color:var(--text-muted); margin-top:4px;">
          Add more columns (e.g., <code>Housing</code>, <code>Housing Confidence</code>) to
          <code>history-data.csv</code>, then mirror the chart setup in the script below to
          give each market its own combined Price + Confidence chart.
        </p>
      </section>
    </main>

    <footer>
      Data source: <code>history-data.csv</code> &middot; Columns like
      <code>Bitcoin</code>, <code>Gold Spot Price</code>, <code>S&amp;P 500</code>, and optional
      <code>Bitcoin Confidence</code>, etc.
    </footer>
  </div>

  <script>
    // ---- 1. CSV LOADING & PARSING ----------------------------------------

    async function loadCSV(url) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(`Failed to load CSV: ${response.status} ${response.statusText}`);
      }
      const text = await response.text();
      return parseCSV(text);
    }

    function parseCSV(csvText) {
      const lines = csvText.trim().split(/\r?\n/);
      const headers = lines[0].split(",").map(h => h.trim());

      const rows = lines.slice(1).map(line => {
        const cells = line.split(",").map(c => c.trim());
        const obj = {};
        headers.forEach((header, idx) => {
          const value = cells[idx] ?? "";

          if (header === "Date") {
            obj[header] = value; // keep as string
          } else if (value === "") {
            obj[header] = null;
          } else {
            const num = Number(value);
            obj[header] = Number.isNaN(num) ? null : num;
          }
        });
        return obj;
      });

      return { headers, rows };
    }

    // ---- 2. CHART FACTORY (Price + Confidence, single chart) -------------

    function createPriceConfidenceChart(ctx, options) {
      const {
        labels,
        priceData,
        confidenceData,
        priceLabel,
        confLabel
      } = options;

      return new Chart(ctx, {
        type: "line",
        data: {
          labels,
          datasets: [
            {
              label: priceLabel,
              data: priceData,
              yAxisID: "yPrice",
              tension: 0.25,
              pointRadius: 0,
              borderWidth: 2
            },
            {
              label: confLabel,
              data: confidenceData,
              yAxisID: "yConf",
              tension: 0.25,
              pointRadius: 0,
              borderDash: [4, 4],
              borderWidth: 2
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          interaction: {
            mode: "index",
            intersect: false
          },
          plugins: {
            legend: {
              labels: {
                font: { size: 10 }
              }
            },
            tooltip: {
              callbacks: {
                label: (ctx) => {
                  const label = ctx.dataset.label || "";
                  const value = ctx.parsed.y;
                  if (label.toLowerCase().includes("confidence")) {
                    return `${label}: ${value.toFixed(0)}%`;
                  }
                  return `${label}: ${value.toFixed(2)}`;
                }
              }
            }
          },
          scales: {
            x: {
              grid: { display: false },
              ticks: {
                autoSkip: true,
                maxTicksLimit: 6,
                font: { size: 9 }
              }
            },
            yPrice: {
              type: "linear",
              position: "left",
              grid: {
                drawOnChartArea: true
              },
              ticks: {
                font: { size: 9 }
              }
            },
            yConf: {
              type: "linear",
              position: "right",
              min: 0,
              max: 100,
              grid: {
                drawOnChartArea: false
              },
              ticks: {
                callback: v => v + "%",
                font: { size: 9 }
              }
            }
          }
        }
      });
    }

    // ---- 3. PUTTING IT ALL TOGETHER -------------------------------------

    async function initHistoryPage() {
      try {
        const { rows } = await loadCSV("history-data.csv");

        // Extract shared labels from Date column
        const labels = rows.map(r => r["Date"]);

        // Helper: safely map a numeric column
        function col(name) {
          return rows.map(r => (r[name] != null ? r[name] : null));
        }

        // ---- Bitcoin ----
        const btcCtx = document.getElementById("btcChart").getContext("2d");
        createPriceConfidenceChart(btcCtx, {
          labels,
          priceData: col("Bitcoin"),
          confidenceData: col("Bitcoin Confidence"), // you can add this col later
          priceLabel: "Bitcoin Price (USD)",
          confLabel: "Bitcoin Confidence (%)"
        });

        // ---- Gold ----
        const goldCtx = document.getElementById("goldChart").getContext("2d");
        createPriceConfidenceChart(goldCtx, {
          labels,
          priceData: col("Gold Spot Price"),
          confidenceData: col("Gold Confidence"), // optional column
          priceLabel: "Gold Spot Price (USD/oz)",
          confLabel: "Gold Confidence (%)"
        });

        // ---- S&P 500 ----
        const spxCtx = document.getElementById("spxChart").getContext("2d");
        createPriceConfidenceChart(spxCtx, {
          labels,
          priceData: col("S&P 500"),
          confidenceData: col("S&P Confidence"), // optional column
          priceLabel: "S&P 500 Index Level",
          confLabel: "S&P Confidence (%)"
        });

        // ---- Market Confidence (single line) ----
        const mcCtx = document.getElementById("marketConfidenceChart").getContext("2d");
        new Chart(mcCtx, {
          type: "line",
          data: {
            labels,
            datasets: [
              {
                label: "Market Confidence",
                data: col("Market Confidence"),
                tension: 0.25,
                pointRadius: 0,
                borderWidth: 2
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { labels: { font: { size: 10 } } },
              tooltip: {
                callbacks: {
                  label: (ctx) => {
                    const value = ctx.parsed.y;
                    return `Market Confidence: ${value.toFixed(0)}%`;
                  }
                }
              }
            },
            scales: {
              x: {
                grid: { display: false },
                ticks: { autoSkip: true, maxTicksLimit: 6, font: { size: 9 } }
              },
              y: {
                min: 0,
                max: 100,
                ticks: { callback: (v) => v + "%", font: { size: 9 } }
              }
            }
          }
        });


      } catch (err) {
        console.error(err);
        alert("Failed to load history-data.csv. Check file path and format in the console.");
      }
    }

    initHistoryPage();
  </script>
</body>
</html>
