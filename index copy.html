<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Market Confidence Tracker</title>
  <!-- Viewport for scaling to all screen sizes -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Google Font (modern, finance-style) -->
  <!-- You can swap this for another font like Montserrat, Poppins, etc. -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />

  <style>
    :root {
      /* Core palette */
      --color-primary: #0bbf7a;      /* green */
      --color-primary-soft: rgba(11, 191, 122, 0.1);
      --color-secondary: #2b6cb0;    /* blue */
      --color-secondary-soft: rgba(43, 108, 176, 0.12);

      --color-positive: #22c55e;
      --color-negative: #f97373;
      --color-neutral: #e2e8f0;

      /* Light theme defaults */
      --bg-body: #f3f5f9;
      --bg-surface: #ffffff;
      --bg-surface-alt: #f8fafc;
      --bg-navbar: #0b1220;
      --bg-sidebar: #ffffff;

      --text-main: #111827;
      --text-soft: #6b7280;
      --text-strong: #0f172a;

      --border-subtle: #e5e7eb;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.12);
      --shadow-card: 0 10px 30px rgba(15, 23, 42, 0.09);

      --radius-lg: 18px;
      --radius-xl: 22px;
      --radius-pill: 999px;

      --transition-fast: 0.18s ease-out;
    }

    /* Dark theme overrides */
    body.theme-dark {
      --bg-body: #020617;
      --bg-surface: #020617;
      --bg-surface-alt: #020617;
      --bg-navbar: #020617;
      --bg-sidebar: #020617;

      --text-main: #e5e7eb;
      --text-soft: #9ca3af;
      --text-strong: #f9fafb;

      --border-subtle: #1f2937;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.6);
      --shadow-card: 0 10px 30px rgba(15, 23, 42, 0.7);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Urbanist", system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
      background: radial-gradient(circle at top left, #0bbf7a11, transparent 55%),
                  radial-gradient(circle at top right, #2b6cb011, transparent 55%),
                  var(--bg-body);
      color: var(--text-main);
      min-height: 100vh;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    /* Top Navbar (desktop baseline) */
    .top-nav {
      position: sticky;
      top: 0;
      z-index: 20;
      background: linear-gradient(90deg, #020617 0%, #020617 50%, #020617 100%);
      color: #e5e7eb;
      padding: 0.7rem 1.5rem;
      border-bottom: 1px solid rgba(148, 163, 184, 0.25);
      display: flex;
      align-items: center;
      justify-content: space-between;
      backdrop-filter: blur(18px);
    }

    .nav-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .brand-mark {
      width: 36px;
      height: 36px;
      border-radius: 16px;
      background: radial-gradient(circle at 20% 20%, #34d399, #0bbf7a 40%, #0369a1);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 12px 30px rgba(34, 197, 94, 0.4);
      font-weight: 700;
      font-size: 1.1rem;
      letter-spacing: 0.03em;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 0.1rem;
    }

    .brand-title {
      font-size: 1.05rem;
      font-weight: 600;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .brand-subtitle {
      font-size: 0.76rem;
      color: #9ca3af;
    }

    .nav-links {
      display: flex;
      gap: 1rem;
      align-items: center;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.11em;
    }

    .nav-links a {
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      color: #9ca3af;
      border: 1px solid transparent;
      transition: color var(--transition-fast),
                  border-color var(--transition-fast),
                  background-color var(--transition-fast);
    }

    .nav-links a:hover {
      color: #e5e7eb;
      border-color: rgba(148, 163, 184, 0.4);
      background-color: rgba(15, 23, 42, 0.8);
    }

    .nav-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .pill-badge {
      border-radius: var(--radius-pill);
      padding: 0.25rem 0.7rem;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(51, 65, 85, 0.9);
      font-size: 0.7rem;
      color: #9ca3af;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: radial-gradient(circle, #34d399, #22c55e);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.8);
    }

    .theme-toggle-btn {
      border-radius: var(--radius-pill);
      padding: 0.3rem 0.8rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.8);
      color: #e5e7eb;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      cursor: pointer;
      transition: background-color var(--transition-fast),
                  transform var(--transition-fast);
    }

    .theme-toggle-btn:hover {
      background-color: rgba(15, 23, 42, 1);
      transform: translateY(-1px);
    }

    .theme-toggle-icon {
      font-size: 0.95rem;
    }

    /* Layout (desktop baseline) */
    .layout {
      display: grid;
      grid-template-columns: 260px minmax(0, 1fr);
      gap: 1.5rem;
      padding: 1.5rem;
      max-width: 1400px;
      margin: 0 auto;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    /* Sidebar */
    .sidebar {
      background-color: var(--bg-sidebar);
      border-radius: var(--radius-xl);
      padding: 1.25rem 1.1rem;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      position: sticky;
      top: 4.5rem;
      align-self: flex-start;
    }

    .sidebar-title {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-strong);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .sidebar-subtitle {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-top: 0.15rem;
    }

    .time-range-group,
    .market-filter-group {
      display: flex;
      flex-direction: column;
      gap: 0.45rem;
    }

    .chip-label {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.14em;
      color: var(--text-soft);
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    .chip-btn {
      border-radius: var(--radius-pill);
      padding: 0.25rem 0.7rem;
      font-size: 0.78rem;
      border: 1px solid var(--border-subtle);
      background: var(--bg-surface-alt);
      color: var(--text-soft);
      cursor: pointer;
      transition: background-color var(--transition-fast),
                  color var(--transition-fast),
                  border-color var(--transition-fast),
                  transform var(--transition-fast);
    }

    .chip-btn:hover {
      transform: translateY(-1px);
      border-color: rgba(148, 163, 184, 0.9);
    }

    .chip-btn.chip-active {
      background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
      color: #f9fafb;
      border-color: transparent;
    }

    .sidebar-divider {
      height: 1px;
      background: linear-gradient(to right, transparent, var(--border-subtle), transparent);
      margin: 0.4rem 0;
    }

    .sidebar-footnote {
      font-size: 0.7rem;
      color: var(--text-soft);
      line-height: 1.5;
    }

    /* Main content */
    main {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    .overview-card {
      background: radial-gradient(circle at 0 0, var(--color-primary-soft), transparent 55%),
                  radial-gradient(circle at 100% 100%, var(--color-secondary-soft), transparent 55%),
                  var(--bg-surface);
      border-radius: 24px;
      padding: 1.4rem 1.4rem 1.1rem;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.45);
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .section-title-block {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .section-kicker {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: var(--color-secondary);
      font-weight: 600;
    }

    .section-title {
      font-size: 1.15rem;
      font-weight: 600;
      color: var(--text-strong);
    }

    .section-subtitle {
      font-size: 0.85rem;
      color: var(--text-soft);
    }

    .section-meta {
      display: flex;
      align-items: center;
      gap: 0.65rem;
      font-size: 0.78rem;
    }

    .meta-pill {
      border-radius: var(--radius-pill);
      padding: 0.25rem 0.7rem;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--text-soft);
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .meta-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.7);
    }

    .overview-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 1rem;
    }

    @media (max-width: 1100px) {
      .overview-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 700px) {
      .overview-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Confidence card reusable component */

    .confidence-card {
      position: relative;
      background: var(--bg-surface);
      border-radius: var(--radius-lg);
      padding: 0.9rem 1rem;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-card);
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      overflow: hidden;
    }

    .confidence-card::before {
      content: "";
      position: absolute;
      inset: 0;
      opacity: 0.07;
      background: radial-gradient(circle at 0 0, #22c55e, transparent 50%),
                  radial-gradient(circle at 100% 100%, #0ea5e9, transparent 55%);
      pointer-events: none;
    }

    .card-top-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      z-index: 1;
    }

    .card-title {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text-strong);
    }

    .tag-pill {
      font-size: 0.65rem;
      padding: 0.2rem 0.5rem;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--text-soft);
      background: rgba(15, 23, 42, 0.02);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .card-metric-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      z-index: 1;
      margin-top: 0.2rem;
    }

    .confidence-score {
      font-size: 1.7rem;
      font-weight: 600;
      color: var(--text-strong);
      display: flex;
      align-items: baseline;
      gap: 0.15rem;
    }

    .confidence-score span.unit {
      font-size: 0.9rem;
      color: var(--text-soft);
      font-weight: 500;
    }

    .trend-pill {
      font-size: 0.78rem;
      border-radius: var(--radius-pill);
      padding: 0.2rem 0.6rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      font-weight: 500;
    }

    .trend-up {
      background: rgba(34, 197, 94, 0.1);
      color: #16a34a;
    }

    .trend-down {
      background: rgba(248, 113, 113, 0.12);
      color: #dc2626;
    }

    .trend-flat {
      background: rgba(148, 163, 184, 0.18);
      color: #4b5563;
    }

    .trend-arrow {
      font-size: 0.9rem;
    }

    .card-bottom-row {
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 0.6rem;
      margin-top: 0.45rem;
      z-index: 1;
    }

    .sparkline {
      flex: 1;
      display: flex;
      align-items: flex-end;
      gap: 2px;
      height: 40px;
    }

    .sparkline-bar {
      flex: 1;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(45, 212, 191, 1), rgba(56, 189, 248, 0.1));
    }

    .sparkline-bar.muted {
      opacity: 0.5;
    }

    .confidence-label {
      font-size: 0.75rem;
      color: var(--text-soft);
      text-align: right;
    }

    /* Detailed sections */

    .market-section {
      background: var(--bg-surface);
      border-radius: 22px;
      padding: 1.2rem 1.3rem;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 0.9rem;
    }

    .market-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1.2fr);
      gap: 1rem;
    }

    @media (max-width: 900px) {
      .market-layout {
        grid-template-columns: 1fr;
      }
    }

    .market-meta {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .market-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .market-name {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-strong);
    }

    .market-tag-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.25rem;
    }

    .market-description {
      font-size: 0.83rem;
      color: var(--text-soft);
      line-height: 1.45;
    }

    .market-confidence-row {
      display: flex;
      align-items: baseline;
      gap: 0.8rem;
      margin-top: 0.3rem;
    }

    .market-confidence-big {
      font-size: 2.1rem;
      font-weight: 600;
      color: var(--text-strong);
      display: flex;
      align-items: baseline;
      gap: 0.2rem;
    }

    .market-confidence-big span.unit {
      font-size: 1rem;
      color: var(--text-soft);
      font-weight: 500;
    }

    .market-confidence-text {
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .market-sparkline-card {
      border-radius: 18px;
      border: 1px dashed var(--border-subtle);
      padding: 0.9rem;
      background: var(--bg-surface-alt);
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .sparkline-title-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.8rem;
      color: var(--text-soft);
    }

    .sparkline-legend {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }

    .legend-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: linear-gradient(135deg, #22c55e, #0ea5e9);
    }

    .market-commentary {
      font-size: 0.8rem;
      color: var(--text-soft);
      line-height: 1.5;
    }

    /* Loading & error */

    .status-banner {
      font-size: 0.78rem;
      color: var(--text-soft);
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
    }

    .status-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #eab308;
      box-shadow: 0 0 12px rgba(234, 179, 8, 0.7);
    }

    .status-dot.ok {
      background: #22c55e;
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.7);
    }

    .status-dot.error {
      background: #ef4444;
      box-shadow: 0 0 12px rgba(239, 68, 68, 0.7);
    }

    .error-text {
      color: #ef4444;
    }

    /* ==========================================
       RESPONSIVE BEHAVIOR (TABLETS / PHONES)
       - All changes below are additive and
         do NOT affect large desktop look.
       ========================================== */

    /* Medium screens: tablets / small laptops (<= 900px) */
    @media (max-width: 900px) {
      /* Navbar: allow wrapping so logo + nav don't overflow */
      .top-nav {
        padding: 0.7rem 1rem;
        flex-wrap: wrap;              /* nav items can move to next line */
        row-gap: 0.5rem;
      }

      .nav-left {
        flex-wrap: wrap;
        row-gap: 0.5rem;
      }

      .nav-links {
        flex-wrap: wrap;              /* nav links wrap instead of overflowing */
        justify-content: flex-start;
      }

      .section-header {
        flex-wrap: wrap;              /* overview header wraps nicely */
        align-items: flex-start;
      }

      /* Sidebar: no sticky on small screens (avoids odd scroll behavior) */
      .sidebar {
        position: static;
        top: auto;
      }
    }

    /* Small screens: phones (<= 600px) */
    @media (max-width: 600px) {
      /* Slightly tighter global padding for small screens */
      .layout {
        padding: 1rem 0.75rem;
      }

      /* Brand text: scale down a touch to avoid crowding */
      .brand-title {
        font-size: 0.95rem;
      }

      .brand-subtitle {
        font-size: 0.7rem;
      }

      /* Navbar links: keep readable, but tighter to fit narrow widths */
      .nav-links {
        font-size: 0.75rem;
        gap: 0.5rem;
      }

      .nav-links a {
        padding: 0.3rem 0.55rem;
      }

      /* Buttons / chips: make touch-friendly (~40px high) */
      .chip-btn {
        padding: 0.4rem 0.8rem;
        min-height: 40px;
      }

      .theme-toggle-btn {
        padding: 0.35rem 0.9rem;
        min-height: 40px;
      }

      /* Sections: reduce border radius slightly for compact feel */
      .overview-card,
      .market-section,
      .sidebar {
        border-radius: 18px;
      }

      /* Section header: stack title + meta vertically to avoid squeeze */
      .section-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .section-meta {
        width: 100%;
        flex-wrap: wrap;
      }

      /* Market layout: ensure clean vertical stacking (text above chart) */
      .market-layout {
        grid-template-columns: 1fr;
      }

      .market-header-row {
        flex-wrap: wrap;
      }

      .market-confidence-row {
        flex-wrap: wrap;
      }
    }
  </style>
</head>

<body class="theme-light">
  <header class="top-nav">
    <div class="nav-left">
      <div class="brand-mark">MC</div>
      <div class="brand-text">
        <div class="brand-title">Market Confidence</div>
        <div class="brand-subtitle">Multi-asset macro sentiment dashboard</div>
      </div>
      <nav class="nav-links">
        <a href="#overview">Overview</a>
        <a href="#section-stocks">Stocks</a>
        <a href="#section-bitcoin">Bitcoin</a>
        <a href="#section-housing">Housing</a>
        <a href="#section-etfs">ETFs</a>
        <a href="#section-gold">Gold</a>
        <a href="#section-rates">Rates</a>
        <a href="#section-usd">U.S. Dollar</a>
      </nav>
    </div>
    <div class="nav-right">
      <div class="pill-badge">
        <span class="pill-dot"></span>
        Live-ready mock data
      </div>
      <button id="themeToggle" class="theme-toggle-btn" type="button">
        <span class="theme-toggle-icon">ðŸŒž</span>
        <span class="theme-toggle-text">Light</span>
      </button>
    </div>
  </header>

  <div class="layout">
    <!-- Sidebar / Filters -->
    <aside class="sidebar">
      <div>
        <div class="sidebar-title">
          Time Horizon
        </div>
        <div class="sidebar-subtitle">
          Adjust the lookback window for confidence calculations.
        </div>
      </div>

      <div class="time-range-group">
        <div class="chip-label">Time Range</div>
        <div class="chip-row" id="timeRangeChips">
          <!-- Add/remove ranges here if needed -->
          <button class="chip-btn chip-active" data-range="24h">24 hours</button>
          <button class="chip-btn" data-range="7d">7 days</button>
          <button class="chip-btn" data-range="30d">30 days</button>
        </div>
      </div>

      <div class="sidebar-divider"></div>

      <div class="market-filter-group">
        <div class="chip-label">Quick Focus</div>
        <div class="chip-row">
          <!-- These are just visual/dummy filters for now -->
          <button class="chip-btn">Equities</button>
          <button class="chip-btn">Crypto</button>
          <button class="chip-btn">Macro</button>
          <button class="chip-btn">Safe Haven</button>
        </div>
      </div>

      <div class="sidebar-divider"></div>

      <div class="sidebar-footnote">
        All values shown are mock data and for demonstration only. You can
        plug in <strong>Polymarket</strong> and other APIs in the script
        section to power this dashboard with real-time or daily data.
      </div>
    </aside>

    <!-- Main Content -->
    <main>
      <!-- Overview -->
      <section id="overview" class="overview-card">
        <div class="section-header">
          <div class="section-title-block">
            <div class="section-kicker">Overview</div>
            <div class="section-title">Cross-asset confidence snapshot</div>
            <div class="section-subtitle">
              Unified 0â€“100 confidence scores across equities, crypto, housing, and macro assets.
            </div>
          </div>
          <div class="section-meta">
            <div id="statusBanner" class="status-banner">
              <span class="status-dot"></span>
              <span>Status: initializingâ€¦</span>
            </div>
          </div>
        </div>

        <div id="overviewGrid" class="overview-grid">
          <!-- Confidence cards injected here -->
        </div>
      </section>

      <!-- Detailed sections (one per market) -->
      <section id="section-stocks" class="market-section" data-market-id="stocks"></section>
      <section id="section-bitcoin" class="market-section" data-market-id="bitcoin"></section>
      <section id="section-housing" class="market-section" data-market-id="housing"></section>
      <section id="section-etfs" class="market-section" data-market-id="etfs"></section>
      <section id="section-gold" class="market-section" data-market-id="gold"></section>
      <section id="section-rates" class="market-section" data-market-id="rates"></section>
      <section id="section-usd" class="market-section" data-market-id="usd"></section>
    </main>
  </div>

  <script>
    // -------------------------------
    // Core data model & initial state
    // -------------------------------

    /**
     * Each market object uses a normalized confidence score (0â€“100),
     * and a percentage change over the selected time window.
     *
     * When you plug in real APIs, you can transform their raw values
     * into this structure before rendering.
     */
    const API_BASE = "http://127.0.0.1:8000/api";  
    const initialMarkets = [
      {
        id: "stocks",
        name: "Stock Market",
        type: "Equities",
        description: "S&P 500 and major global indices, aggregating earnings, macro data, and risk sentiment.",
        confidence: 68,
        change24h: 2.4,
        dataPoints: [55, 58, 60, 63, 61, 64, 68],
      },
      {
        id: "bitcoin",
        name: "Bitcoin / Crypto",
        type: "Crypto",
        description: "Crypto market risk appetite anchored around BTC dominance and majorsâ€™ volatility.",
        confidence: 61,
        change24h: -1.2,
        dataPoints: [70, 68, 66, 65, 64, 63, 61],
      },
      {
        id: "housing",
        name: "Housing Market",
        type: "Real Estate",
        description: "Composite confidence from listing activity, pricing momentum, and builder sentiment.",
        confidence: 57,
        change24h: 0.3,
        dataPoints: [52, 54, 55, 56, 57, 57, 57],
      },
      {
        id: "etfs",
        name: "Thematic ETFs",
        type: "Equities",
        description: "Broad basket of sector and thematic ETFs to capture rotating market narratives.",
        confidence: 64,
        change24h: 1.1,
        dataPoints: [60, 61, 63, 62, 63, 64, 64],
      },
      {
        id: "gold",
        name: "Gold",
        type: "Safe Haven",
        description: "Gold positioning as a proxy for risk-off hedging and inflation expectations.",
        confidence: 72,
        change24h: 0.9,
        dataPoints: [65, 66, 68, 69, 70, 71, 72],
      },
      {
        id: "rates",
        name: "Interest Rates",
        type: "Macro",
        description: "Rate expectations and forward curves summarized into a single risk lens.",
        confidence: 49,
        change24h: -0.7,
        dataPoints: [55, 53, 52, 51, 50, 49, 49],
      },
      {
        id: "usd",
        name: "U.S. Dollar Strength",
        type: "FX",
        description: "Dollar strength vs. major peers, capturing global risk and liquidity demand.",
        confidence: 66,
        change24h: 1.7,
        dataPoints: [60, 61, 62, 63, 64, 65, 66],
      },
    ];

    const state = {
      markets: structuredClone(initialMarkets),
      timeRange: "24h", // '24h' | '7d' | '30d'
      loading: false,
      error: null,
      theme: "light", // 'light' | 'dark'
    };

    // Utility to get DOM elements
    const el = (selector) => document.querySelector(selector);

    // ---------------------
    // Rendering helpers
    // ---------------------

    function getConfidenceLabel(score) {
      if (score >= 70) return "High confidence";
      if (score >= 50) return "Moderate confidence";
      return "Low confidence";
    }

    function getTrendInfo(change) {
      if (change > 0.1) {
        return {
          cls: "trend-up",
          label: `+${change.toFixed(1)}%`,
          arrow: "â–²",
        };
      } else if (change < -0.1) {
        return {
          cls: "trend-down",
          label: `${change.toFixed(1)}%`,
          arrow: "â–¼",
        };
      } else {
        return {
          cls: "trend-flat",
          label: `${change.toFixed(1)}%`,
          arrow: "â–¬",
        };
      }
    }

    /**
     * Creates a sparkline-like bar chart as HTML
     * using the dataPoints array (normalized by its max).
     */
    function createSparklineHTML(dataPoints, emphasizeLast = true) {
      if (!dataPoints || dataPoints.length === 0) return "";
      const max = Math.max(...dataPoints);
      const bars = dataPoints.map((v, idx) => {
        const heightPercent = max === 0 ? 0 : (v / max) * 100;
        const muted = emphasizeLast && idx !== dataPoints.length - 1;
        return `<div class="sparkline-bar${muted ? " muted" : ""}" style="height:${heightPercent.toFixed(
          0
        )}%;"></div>`;
      });
      return `<div class="sparkline">${bars.join("")}</div>`;
    }

    /**
     * Reusable "confidence card" component (Overview grid).
     */
    function createConfidenceCardHTML(market) {
      const trend = getTrendInfo(market.change24h);
      const label = getConfidenceLabel(market.confidence);

      return `
        <article class="confidence-card">
          <div class="card-top-row">
            <h3 class="card-title">${market.name}</h3>
            <span class="tag-pill">${market.type}</span>
          </div>

          <div class="card-metric-row">
            <div class="confidence-score">
              ${market.confidence.toFixed(0)}<span class="unit">/100</span>
            </div>
            <div class="trend-pill ${trend.cls}">
              <span class="trend-arrow">${trend.arrow}</span>
              <span>${trend.label}</span>
            </div>
          </div>

          <div class="card-bottom-row">
            ${createSparklineHTML(market.dataPoints)}
            <div class="confidence-label">${label}</div>
          </div>
        </article>
      `;
    }

    function renderOverview() {
      const container = el("#overviewGrid");
      if (!container) return;

      container.innerHTML = state.markets
        .map((m) => createConfidenceCardHTML(m))
        .join("");
    }

    function renderStatusBanner() {
      const banner = el("#statusBanner");
      if (!banner) return;

      const dot = banner.querySelector(".status-dot");
      const text = banner.querySelector("span:nth-child(2)");

      if (state.loading) {
        dot.className = "status-dot";
        text.textContent = "Status: fetching latest dataâ€¦";
      } else if (state.error) {
        dot.className = "status-dot error";
        text.textContent = "Status: error loading data";
      } else {
        dot.className = "status-dot ok";
        text.textContent = "Status: mock data (refresh to plug in APIs)";
      }
    }

    function renderMarketSections() {
      state.markets.forEach((market) => {
        const section = document.querySelector(
          `.market-section[data-market-id="${market.id}"]`
        );
        if (!section) return;

        const trend = getTrendInfo(market.change24h);
        const label = getConfidenceLabel(market.confidence);

        section.innerHTML = `
          <div class="section-header">
            <div class="section-title-block">
              <div class="section-kicker">${market.type}</div>
              <div class="section-title">${market.name}</div>
              <div class="section-subtitle">
                ${market.description}
              </div>
            </div>
            <div class="section-meta">
              <div class="meta-pill">
                <span class="meta-dot"></span>
                Normalized 0â€“100 confidence
              </div>
              <div class="meta-pill">
                Range: ${state.timeRange}
              </div>
            </div>
          </div>

          <div class="market-layout">
            <div class="market-meta">
              <div class="market-header-row">
                <div>
                  <div class="market-name">${market.name}</div>
                  <div class="market-tag-row">
                    <span class="tag-pill">${market.type}</span>
                    <span class="tag-pill">${label}</span>
                  </div>
                </div>
              </div>

              <div class="market-confidence-row">
                <div class="market-confidence-big">
                  ${market.confidence.toFixed(0)}<span class="unit">/100</span>
                </div>
                <div>
                  <div class="trend-pill ${trend.cls}">
                    <span class="trend-arrow">${trend.arrow}</span>
                    <span>${trend.label}</span>
                  </div>
                  <div class="market-confidence-text">
                    vs. previous ${state.timeRange} window
                  </div>
                </div>
              </div>

              <p class="market-commentary">
                ${label} in the ${market.name.toLowerCase()} reflects a blend of positioning,
                volatility, and macro expectations. You can replace this text with
                commentary generated from real API data (for example, Polymarket
                probability shifts or ETF flow data).
              </p>
            </div>

            <div class="market-sparkline-card">
              <div class="sparkline-title-row">
                <span>Recent confidence path</span>
                <div class="sparkline-legend">
                  <span class="legend-dot"></span>
                  <span>${state.timeRange} composite</span>
                </div>
              </div>
              ${createSparklineHTML(market.dataPoints, true)}
            </div>
          </div>
        `;
      });
    }

    function renderTheme() {
      const button = el("#themeToggle");
      if (!button) return;

      const iconEl = button.querySelector(".theme-toggle-icon");
      const textEl = button.querySelector(".theme-toggle-text");

      if (state.theme === "light") {
        document.body.classList.remove("theme-dark");
        document.body.classList.add("theme-light");
        iconEl.textContent = "ðŸŒž";
        textEl.textContent = "Light";
      } else {
        document.body.classList.remove("theme-light");
        document.body.classList.add("theme-dark");
        iconEl.textContent = "ðŸŒ™";
        textEl.textContent = "Dark";
      }
    }

    function renderDashboard() {
      renderTheme();
      renderOverview();
      renderMarketSections();
      renderStatusBanner();
    }

    // ---------------------
    // Event handlers
    // ---------------------

    function setupThemeToggle() {
      const button = el("#themeToggle");
      if (!button) return;

      button.addEventListener("click", () => {
        state.theme = state.theme === "light" ? "dark" : "light";
        renderTheme();
      });
    }

    function setupTimeRangeChips() {
      const container = el("#timeRangeChips");
      if (!container) return;

      container.addEventListener("click", (event) => {
        const btn = event.target.closest(".chip-btn");
        if (!btn) return;

        const selectedRange = btn.dataset.range;
        if (!selectedRange || selectedRange === state.timeRange) return;

        state.timeRange = selectedRange;

        container
          .querySelectorAll(".chip-btn")
          .forEach((chip) => chip.classList.remove("chip-active"));
        btn.classList.add("chip-active");

        // In the future you could re-normalize or re-fetch data
        renderDashboard();
      });
    }

    // ---------------------
    // API integration (mock)
    // ---------------------

    /**
     * This function shows how you could structure async fetching
     * from multiple APIs (Polymarket, price feeds, etc.).
     *
     * Right now it uses mock data and a timeout so the structure is clear.
     */
    function updateMarketFromScore(market, newScore) {
  if (typeof newScore !== "number" || Number.isNaN(newScore)) return market;

  const prev = market.confidence;
  const change = newScore - prev;
  const newDataPoints = [...market.dataPoints, newScore].slice(-7);

  return {
        ...market,
        confidence: newScore,
        change24h: change,
        dataPoints: newDataPoints,
      };
    }
async function refreshDataFromAPIs() {
  state.loading = true;
  state.error = null;
  renderStatusBanner();

  try {
    // 1. Hit your Python backend
    const [confRes, assetsRes] = await Promise.all([
      fetch(`${API_BASE}/confidence`),
      fetch(`${API_BASE}/assets`),
    ]);

    if (!confRes.ok || !assetsRes.ok) {
      throw new Error("Backend responded with an error");
    }

    const confidenceData = await confRes.json();
    const assetsData = await assetsRes.json();

    const indicators = assetsData.indicators || [];

    const findAsset = (id) => indicators.find((a) => a.assetId === id);

    // Pull out some useful scores from backend
    const stocksScore = confidenceData.marketConfidence;         // 0â€“100
    const riskAppetiteScore = confidenceData.riskAppetite;       // 0â€“100
    const macroStabilityScore = confidenceData.macroStability;   // 0â€“100

    const btcAsset = findAsset("btc");
    const housingAsset = findAsset("housing");
    const goldAsset = findAsset("gold");

    const btcScore = btcAsset ? btcAsset.momentumScore : null;
    const housingScore = housingAsset ? housingAsset.momentumScore : null;
    // For gold, higher gold = more fear, so invert for "confidence"
    const goldScore = goldAsset ? 100 - goldAsset.momentumScore : null;

    // 2. Build the updated markets array
    const nextMarkets = state.markets.map((m) => {
      switch (m.id) {
        case "stocks":
          return updateMarketFromScore(m, stocksScore);
        case "bitcoin":
          return updateMarketFromScore(m, btcScore);
        case "housing":
          return updateMarketFromScore(m, housingScore);
        case "etfs":
          // Use risk appetite index for thematic ETFs
          return updateMarketFromScore(m, riskAppetiteScore);
        case "gold":
          return updateMarketFromScore(m, goldScore);
        case "rates":
          // Use macro stability as a proxy for rate confidence
          return updateMarketFromScore(m, macroStabilityScore);
        case "usd":
          // We don't have USD strength yet â€“ keep it as-is for now
          return m;
        default:
          return m;
      }
    });

    state.markets = nextMarkets;
    state.loading = false;
    state.error = null;
  } catch (err) {
    console.error("Error refreshing data:", err);
    state.loading = false;
    state.error = err.message || "Unknown error";

    // OPTIONAL: if backend fails, you can fall back to the old jitter logic here
  }

  renderDashboard();
}

    // ---------------------------------
    // Initialization
    // ---------------------------------

    document.addEventListener("DOMContentLoaded", () => {
      setupThemeToggle();
      setupTimeRangeChips();
      renderDashboard();

      // Simulate an initial "API refresh" after page load.
      // You can call this on an interval if you want auto-updates.
      refreshDataFromAPIs();
    });

    // -------------------------------
    // HOW TO PLUG IN REAL API DATA:
    // -------------------------------
    //
    // 1. Inside refreshDataFromAPIs(), replace the mock logic with real fetches:
    //
    //    const polymarketResponse = await fetch("https://api.polymarket.com/...");
    //    const polymarketJson = await polymarketResponse.json();
    //
    // 2. Map the API response into your normalized object:
    //
    //    function normalizePolymarketMarket(pmMarket) {
    //      // Example: map Polymarket probability (0â€“1) to 0â€“100
    //      const confidence = pmMarket.probability * 100;
    //      return {
    //        id: "stocks", // or another id
    //        name: pmMarket.question,
    //        type: "Prediction",
    //        description: pmMarket.description,
    //        confidence,
    //        change24h: pmMarket.change24hPct,
    //        dataPoints: buildDataPointHistory(pmMarket),
    //      };
    //    }
    //
    // 3. Use your normalized objects to update state.markets
    //    and then call renderDashboard().
    //
    // 4. To add a new market:
    //    - Add an object to initialMarkets (id, name, type, description, confidence, change24h, dataPoints)
    //    - Add a <section> in the HTML with data-market-id="yourNewId"
    //    - Done: it will automatically appear in the overview and detail section.
  </script>
</body>
</html>
